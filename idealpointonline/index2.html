<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width">
        <title>Peer-to-Peer Cue System --- Sender</title>
        <script src="peerjs.min.js">
        </script>
	  <script>
  		var recvIdInput;
		var conn = null;
		var peer, lastPeerId;

		function ConnectReceive() {

            peer = new Peer(null, {
                        debug: 2
            });

	        peer.on('open', function (id) {
                    if (peer.id === null) {
                            //alert('Received null id from peer open');
                            peer.id = lastPeerId;
                    } else {
                            lastPeerId = peer.id;
                            document.getElementById("lblMessage").innerHTML = "[CLEAR]"; 
                    } 
		            document.getElementById("lblLocalID").innerHTML = peer.id;
  		    });

            recvIdInput = document.getElementById("txtRemoteID");

            peer.on('connection', function (c) {
                        c.on('open', function() {
 		            	       document.getElementById("lblMessage").innerHTML = "Connected!!";
			            });
                        c.on('data', function (data) {
                        	document.getElementById("lblMessage").innerHTML = data; 
                        });

                        c.on('error', function (err) {
                            alert(err);
                        });

            });

            peer.on('error', function (err) {
                        alert(err);
            });
                    //alert('ID: ' + peer.id);
        
		}
		

          function ConnectSend() {

              peer = new Peer(null, {
                  debug: 2
              });

              peer.on('open', function (id) {
                  if (peer.id === null) {
                      //alert('Received null id from peer open');
                      peer.id = lastPeerId;

                  } else {
                      lastPeerId = peer.id;
                      document.getElementById("lblMessage").innerHTML = "[CLEAR]";
                  }

                  //alert('ID: ' + peer.id);
                  document.getElementById("lblLocalID").innerHTML = peer.id;
              });

              recvIdInput = document.getElementById("txtRemoteID");
              //alert(recvIdInput.value);
              conn = peer.connect(recvIdInput.value);
              //alert(conn.peer);
              conn.on('open', function () {
                  document.getElementById("lblMessage").innerHTML = "Connected to: " + conn.peer;

                  conn.send("FromSender!!");
              });

              conn.on('data', function (data) {
                  document.getElementById("lblMessage").innerHTML = data;
              });

              conn.on('error', function (err) {
                  alert(err);
              });

            peer.on('error', function (err) {
                        alert(err);
            });

          }

       </script>

    </head>
    <body>
	<canvas id="localCanvas">
	</canvas>
	<canvas id="remoteCanvas">
	</canvas>

	<form>
		<label id="lblLocalID">[localID]</label><br>
		<input id="txtRemoteID" type="text"><br><br>
		<label id="lblMessage">[ReceivedText]</label><br>
		<input id="btnReceive" onclick="ConnectReceive()" type="button" value="Connect then in Receiving Mode"><br>
		<input id="btnSend" onclick="ConnectSend()" type="button" value="Connect then Send Text"><br>
	</form>

    </body>
</html>